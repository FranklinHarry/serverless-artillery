service: slsart-integration-target-${self:custom.instanceId}
custom: ${file(./config.yml)}

provider:
  name: aws
  runtime: nodejs6.10
  endpointType: private
  iamRoleStatements:
    -  Effect: "Allow"
       Action:
         - "s3:ListBucket"
         - "s3:PutObject"
         - "s3:GetObject"
         - "s3:DeleteObject"
       Resource: "arn:aws:s3:::slsart-integration-target-${self:custom.instanceId}-reqs"
  usagePlan:
    throttle:
      burstLimit: 10
      rateLimit: 1

functions:
  test:
    handler: handler.test
    events:
      - http:
          path: test/{id}
          method: get
  list:
    handler: handler.list
    events:
      - http:
          path: list/{id}
          method: get

  deleteList:
    handler: handler.deleteList
    events:
      - http:
          path: list/{id}
          method: delete

resources:
  Resources:

    TestBucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: slsart-integration-target-${self:custom.instanceId}-reqs
        LifecycleConfiguration:
          Rules:
            - ExpirationInDays: 1
              Status: Enabled

  Outputs:
     TestApi:
       Description: The URL of the ApiGateway at which to invoke the get function
       Value:
        Ref: ApiGatewayRestApi
       Export:
        Name: ${self:service}-test-api
     ListApi:
       Description: The URL of the ApiGateway at which to invoke the get function
       Value:
        Ref: ApiGatewayRestApi
       Export:
        Name: ${self:service}-list-api
     DeleteListApi:
       Description: The URL of the ApiGateway at which to invoke the get function
       Value:
        Ref: ApiGatewayRestApi
       Export:
        Name: ${self:service}-deletelist-api
